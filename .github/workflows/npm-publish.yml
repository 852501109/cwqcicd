name: Deploy to Nginx

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install dependencies
        run: npm install

      - name: Build project
        run: npm run build

      - name: Copy files to Nginx folder
        run: robocopy ./build F:\nginx-1.17.5\html /E

      - name: Restart Nginx
        run: |
          $ErrorActionPreference = 'Stop'
          & 'F:\nginx-1.17.5\nginx.exe' -s stop
          Start-Sleep -s 2
          & 'F:\nginx-1.17.5\nginx.exe'
